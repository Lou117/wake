# Middlewares
**Wake** implements [PSR-15 (HTTP Server Request Handlers)](https://www.php-fig.org/psr/psr-15/), which define both 
`MiddlewareInterface` and `RequestHandlerInterface`, working in combination.

Middlewares, and specifically title 1.4 of PSR-15 ("Handling Exceptions"), are why you are required to inject a 
configuration array including a "middleware sequence" when using Wake `Kernel` class. Fact is, Wake `Kernel` class 
implements `RequestHandler` interface and expects one of any middleware in sequence to return an instance of PSR-7 
`ResponseInterface`. Without a middleware sequence, Wake kernel **will do nothing**.

This has the advantage of letting you, as a developer, as free as possible: if middlewares included with Wake package 
are not suitable for your use case, you can use your own middleware(s) and use Wake kernel as a `RequestHandler` only, 
with the addition of its [built-in dependency management](/md/dependencies_management.md).

## Understanding middlewares (in Ancient Egypt)
In PHP, *middlewares* are pieces of software that can modify or intercept an incoming request before it being processed 
by a controller, and modify or intercept outgoing responses (either generated by a controller or a middleware) before 
it being sent to client.

Think of your application as an egyptian temple (back to when it was complete and colorful, not in ruins...), with 
multiple halls in it, each hall leading to another. You are the HTTP request, entering the first hall, and everything 
goes well. *You passed the first middleware*. In the second hall, you are given a tool, to be use in the third hall they 
said. The third hall is a dead-end, with a beautiful golden statuette. *You are the last middleware, or most likely a 
controller*. You take the statuette, and go back to where you're from. *You "changed" from HTTP request to HTTP 
response*. You will pass through the halls you already visited, in reverse order, and if everyone finds it normal you 
now have a magnificent statuette in your hands (lucky you), you will make your way to temple exit. Maybe in second hall,
someone will *log* that you left with a statuette.

This is how *middlewares* works, and how *Wake* works.

## Included middlewares
Wake comes with some middlewares included:
- `ExceptionHandlingMiddleware` is a basic middleware you can use to comply with PSR-15 title 1.4, which stands that it 
"[...] is RECOMMENDED that any application using middleware includes a component that catches exceptions and converts 
them into responses". This middleware *should be first* in middleware sequence, to catch as many exceptions as possible.
- `RouterMiddleware` makes use of [Wake integrated router](/md/router.md) to translate incoming request 
into a route, corresponding to a controller.
- `ControllerLoadingMiddleware` can be used in combination with Wake integrated router to load and execute controller 
corresponding to computed route.
